# SPDX-FileCopyrightText: Copyright (C) Nicolas Lamirault <nicolas.lamirault@gmail.com>
# SPDX-License-Identifier: Apache-2.0

---
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
        cors:
          allowed_origins:
          - http://*

extensions:
  health_check:
    endpoint: 0.0.0.0:13133
    path: "/ready"
  pprof:
    endpoint: 0.0.0.0:1777

processors:
  batch:
    send_batch_size: 10000
    send_batch_max_size: 11000
    timeout: 10s
  memory_limiter:
    check_interval: 2s
    limit_mib: 1800
    spike_limit_mib: 500
  attributes:
    actions:
    - key: instance
      action: insert
      value: ai-llm-lab
  resourcedetection:
    detectors: [env, system]
    timeout: 2s

exporters:
  otlphttp/agenta:
    endpoint: "https://cloud.agenta.ai/api/otlp"
    headers:
      Authorization: "ApiKey ${env:AGENTA_API_KEY}" #

  otlphttp/langfuse:
    endpoint: "https://cloud.langfuse.com/api/public/otel" # EU data region
    headers:
      Authorization: "Basic ${env:LANGFUSE_AUTH}"

  otlphttp/langsmith:
    endpoint: https://api.smith.langchain.com/otel
    headers:
      x-api-key: ${env:LANGSMITH_API_KEY}
      Langsmith-Project: ${env:LANGSMITH_PROJECT}

  otlphttp/traceloop:
    endpoint: "https://api.traceloop.com" # US instance
    headers:
      Authorization: "Bearer ${env:TRACELOOP_API_KEY}"
      # x-traceloop-destination-id: ${env:TRACELOOP_DEST_ID}

  otlphttp/braintrust:
    endpoint: "https://api.braintrust.dev/otel"
    headers:
      Authorization: "Bearer ${env:BRAINTRUST_API_KEY}"
      x-bt-parent: "project_name:${env:BRAINTRUST_PROJECT_NAME}"

  otlp/laminar:
    endpoint: "https://api.lmnr.ai:8443"
    headers:
      Authorization: "Bearer ${env:LAMINAR_API_KEY}"
      # x-laminar-team: ${env:LAMINAR_TEAM}

  prometheus:
    endpoint: "0.0.0.0:8889"

  debug/traces:
    verbosity: detailed

service:
  telemetry:
    logs:
      level: info
      encoding: json
  extensions:
  - health_check
  - pprof
  pipelines:
    traces:
      receivers:
      - otlp
      processors:
      - batch
      exporters:
      - debug/traces
      - otlphttp/agenta
      - otlphttp/langfuse
      - otlphttp/langsmith
      - otlphttp/traceloop
      - otlphttp/braintrust
      - otlp/laminar
